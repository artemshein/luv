{% if p:getTotal() then %}
	{% local modelUrl = urlConf:getBaseUri().."/"..urlConf:getCapture(1) %}
	{% local pageNav = include("admin/_pagenav.html", {func="setPage"}) %}
	{{ safe(pageNav) }}
	<form id="items">
	<table><thead>
		<th></th>
	{% for _, field in ipairs(displayFields) do %}
		{% local f = model:getField(field) %}
		<th>{{ capitalize(tr(f and f:getLabel() or admin[field][1])) }}</th>
	{% end %}
	</thead>
	{% for _, record in ipairs(p:getPage(page):getValue()) do %}
		<tr class="record">
			<td width="10"><input type="checkbox" name="items" value="{{ record.pk }}" /></td>
		{% for _, field in ipairs(displayFields) do %}
			<td class="activeLink" onclick="selectRecord('{{ record.pk }}')">
				{% local f = record:getField(field) %}
				{% if f then %}
					{% if f:isKindOf(fields.Datetime) then %}
						{{ record:getField(field) }}
					{% else %}
						{% local choices = f:getChoices() %}
						{% if 'function' == type(choices) then choices = choices() end %}
						{% local value = record[field] %}
						{% if choices then %}
							{{ value and choices[value] or "" }}
						{% else %}
							{{ value or "" }}
						{% end %}
					{% end %}
				{% else %}
					{{ admin[field][2](record) }}
				{% end %}
			</td>
		{% end %}
		</tr>
	{% end %}
	</table>
	</form>
	{{ safe(pageNav) }}
	<script type="text/javascript" language="JavaScript">//<![CDATA[
		function selectRecord (id)
		{
			window.location = '{{ modelUrl }}/'+id;
		}
		$('#records tr.record')
		.mouseover(function(){ $(this).css('background', '#FFC'); })
		.mouseout(function(){ $(this).css('background', '#FFF'); });
	//]]></script>
{% else %}
	<div style="padding:10px 20px">No records.</div>
{% end %}

{{ safe(debugger) }}
